<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>יופינדר - מחפש סרטוני יוטיוב מוסתרים! 🕵️‍♂️</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@400;700&display=swap');
        body {
            font-family: 'Heebo', sans-serif;
            background-color: #0d1117;
            color: #c9d1d9;
            direction: rtl;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .warning-label {
            display: inline-block;
            background-color: #eab308;
            color: #1a202c;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            margin-top: 0.5rem;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 10;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-content {
            background-color: #161b22;
            padding: 24px;
            border-radius: 8px;
            border: 1px solid #30363d;
            max-width: 500px;
            width: 100%;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        .close-button {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #c9d1d9;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>
<body class="p-8">

    <div class="max-w-xl mx-auto bg-[#161b22] p-6 rounded-lg shadow-xl border border-[#30363d]">
        <h1 class="text-3xl font-bold text-center text-white mb-6">יופינדר 🕵️‍♂️</h1>
        <p class="text-center text-sm mb-8 text-gray-400">הכנס קישור לסרטון ביוטיוב שעל פרטי/סרטונים שנמחקו ואנחנו נביא לך את הסרטון!</p>

        <div class="flex flex-col gap-4">
            <input type="text" id="videoUrlInput" placeholder="הכנס קישור לסרטון יוטיוב..." class="w-full px-4 py-3 rounded-lg bg-[#0d1117] text-white border border-[#30363d] focus:outline-none focus:ring-2 focus:ring-[#58a6ff]">
            <div class="flex gap-2">
                <button id="searchButton" class="flex-1 px-4 py-3 rounded-lg bg-[#238636] text-white font-semibold transition-all duration-200 hover:bg-[#2ea043] focus:outline-none focus:ring-2 focus:ring-[#238636] transform hover:scale-103">חפש! 🔗</button>
                <button id="qaButton" class="px-4 py-3 rounded-lg bg-[#58a6ff] text-white font-semibold transition-all duration-200 hover:bg-[#68b7ff] focus:outline-none focus:ring-2 focus:ring-[#58a6ff] transform hover:scale-103">❓</button>
            </div>
        </div>

        <div id="messageContainer" class="mt-8 text-center text-lg hidden">
        </div>

        <p class="text-xs text-gray-500 text-center mt-8">האתר נוצר על ידי <a href="https://github.com/TheYali1" target="_blank" class="text-[#58a6ff] hover:underline">TheYali1</a></p>
    </div>

    <div id="qaModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeModal">&times;</span>
            <h2 class="text-2xl font-bold mb-4">Q&A</h2>
            <div class="mb-4">
                <h3 class="font-bold">איך אני מוצא סרטונים?</h3>
                <p class="text-sm text-gray-400">
                    המדריך המלא בסרטון הבא:<br>
                    <a href="https://youtu.be/auPsLB8LHrU?t=14" target="_blank" class="text-[#58a6ff] hover:underline">https://youtu.be/auPsLB8LHrU?t=14</a><br>
                </p>
            </div>
        </div>
    </div>

    <script>
        const searchButton = document.getElementById('searchButton');
        const videoUrlInput = document.getElementById('videoUrlInput');
        const messageContainer = document.getElementById('messageContainer');
        const qaButton = document.getElementById('qaButton');
        const qaModal = document.getElementById('qaModal');
        const closeModal = document.getElementById('closeModal');
        
        searchButton.addEventListener('click', async () => {
            const videoUrl = videoUrlInput.value.trim();
            messageContainer.classList.add('hidden');
            messageContainer.innerHTML = '';

            const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=|shorts\/)|youtu\.be\/)([^"&?\/\s]{11})/;
            const match = videoUrl.match(regex);

            if (!match || !match[1]) {
                showMessage('קישור לא תקין!', 'text-red-500');
                return;
            }

            showMessage('<div class="flex justify-center"><div class="loader"></div></div>', 'text-gray-400');
            
            const videoId = match[1];
            const fullYouTubeUrl = `https://www.youtube.com/watch?v=${videoId}`;
            
            let oldestWebpageUrl = null;
            
            // Try with the original URL first (e.g., shorts URL)
            try {
                const proxyUrl = `https://corsproxy.io/?` + encodeURIComponent(`https://web.archive.org/cdx/search/cdx?url=${videoUrl}&output=json`);
                const response = await fetch(proxyUrl);
                const data = await response.json();

                if (Array.isArray(data) && data.length > 1) {
                    let oldestTimestamp = Infinity;
                    for (const entry of data.slice(1)) {
                        const originalUrl = entry[2];
                        const timestamp = parseInt(entry[1]);
                        const mimetype = entry[3];
                        
                        if (mimetype.includes('text/html')) {
                            if (timestamp < oldestTimestamp) {
                                oldestTimestamp = timestamp;
                                oldestWebpageUrl = `https://web.archive.org/web/${oldestTimestamp}/${originalUrl}`;
                            }
                        }
                    }
                }
            } catch (err) {
                console.error('Error with original URL search:', err);
            }

            // If not found with original URL, try with the canonical watch?v= URL
            if (!oldestWebpageUrl) {
                try {
                    const proxyUrl = `https://corsproxy.io/?` + encodeURIComponent(`https://web.archive.org/cdx/search/cdx?url=${fullYouTubeUrl}&output=json`);
                    const response = await fetch(proxyUrl);
                    const data = await response.json();

                    if (Array.isArray(data) && data.length > 1) {
                        let oldestTimestamp = Infinity;
                        for (const entry of data.slice(1)) {
                            const originalUrl = entry[2];
                            const timestamp = parseInt(entry[1]);
                            const mimetype = entry[3];
                            
                            if (mimetype.includes('text/html')) {
                                if (timestamp < oldestTimestamp) {
                                    oldestTimestamp = timestamp;
                                    oldestWebpageUrl = `https://web.archive.org/web/${oldestTimestamp}/${originalUrl}`;
                                }
                            }
                        }
                    }
                } catch (err) {
                    console.error('Error with canonical URL search:', err);
                }
            }
            
            if (oldestWebpageUrl) {
                let message = `🎉 מצאתי את הסרטון ותוכל <a href="${oldestWebpageUrl}" target="_blank" class="text-[#58a6ff] hover:underline">לראות אותו פה</a>`;
                message += `<p class="text-xs mt-2 text-gray-500">שימו לב כנראה שהסרטון לא יעבוד בדף!</p>`;
                showMessage(message, 'text-green-500');
            } else {
                showMessage('הסרטון לא נמצא, לצערנו! 😭', 'text-yellow-400');
                const recommendation = document.createElement('p');
                recommendation.className = 'text-xs mt-2 text-gray-500';
                recommendation.innerHTML = 'מומלץ בחום לבדוק בעצמך ב-Wayback Machine';
                messageContainer.appendChild(recommendation);
            }
        });

        function showMessage(text, color) {
            messageContainer.classList.remove('hidden', 'text-red-500', 'text-yellow-400', 'text-green-500', 'text-gray-400');
            messageContainer.innerHTML = text;
            messageContainer.classList.add(color);
        }

        qaButton.addEventListener('click', () => {
            qaModal.style.display = 'flex';
        });

        closeModal.addEventListener('click', () => {
            qaModal.style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            if (event.target == qaModal) {
                qaModal.style.display = 'none';
            }
        });
    </script>

</body>
</html>