<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>יופינדר - מחפש סרטוני יוטיוב מוסתרים! 🕵️‍♂️</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@400;700&display=swap');
        :root {
            --bg-body: #0d1117;
            --bg-card: #161b22;
            --text-color: #c9d1d9;
            --border-color: #30363d;
            --input-bg: #0d1117;
            --input-border-focus: #58a6ff;
            --warning-bg: #eab308;
            --warning-text: #1a202c;
            --header-color: #ffffff;
        }

        .light-mode {
            --bg-body: #f0f6fc;
            --bg-card: #ffffff;
            --text-color: #24292f;
            --border-color: #d0d7de;
            --input-bg: #ffffff;
            --input-border-focus: #0969da;
            --warning-bg: #eab308;
            --warning-text: #1a202c;
            --header-color: #24292f;
        }
        
        body {
            font-family: 'Heebo', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-color);
            direction: rtl;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .main-card {
            background-color: var(--bg-card);
            border-color: var(--border-color);
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            opacity: 0;
            transform: scale(0.95);
        }
        .body-loaded .main-card {
            opacity: 1;
            transform: scale(1);
        }
        
        .header-title {
            color: var(--header-color);
            transition: color 0.3s ease;
        }

        input[type="text"] {
            background-color: var(--input-bg);
            border-color: var(--border-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
        input[type="text"]:focus {
            border-color: var(--input-border-focus);
            box-shadow: 0 0 0 2px var(--input-border-focus);
        }
        .warning-label {
            display: inline-block;
            background-color: var(--warning-bg);
            color: var(--warning-text);
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            margin-top: 0.5rem;
        }
        .loader {
            border: 4px solid var(--border-color);
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s cubic-bezier(0.68, -0.55, 0.27, 1.55) infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 10;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-content {
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            transition: background-color 0.3s ease, border-color 0.3s ease;
            padding: 24px;
            border-radius: 8px;
            max-width: 500px;
            width: 100%;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
            opacity: 0;
            transform: scale(0.9);
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1), transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .modal.is-active .modal-content {
            opacity: 1;
            transform: scale(1);
        }

        .close-button {
            position: absolute;
            top: 10px;
            left: 10px;
            color: var(--text-color);
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>
<body class="p-8">

    <div class="max-w-3xl mx-auto main-card p-6 rounded-lg shadow-xl border">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold header-title">יופינדר <span class="text-white">🕵️‍♂️</span></h1>
            <button id="modeToggle" class="p-2 rounded-full bg-gray-700 text-white transition-all duration-300 hover:bg-gray-600 transform hover:scale-110" aria-label="החלף מצב לילה/יום">
                <svg id="sunIcon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                <svg id="moonIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
            </button>
        </div>
        <p class="text-center text-sm mb-8 text-gray-400">הכנס קישור לסרטון ביוטיוב שעל פרטי/סרטונים שנמחקו ואנחנו נביא לך את הסרטון!</p>

        <div class="flex flex-col gap-4">
            
            <div class="flex gap-2">
                <input type="text" id="videoUrlInput" placeholder="הכנס קישור לסרטון יוטיוב..." class="flex-1 px-4 py-3 rounded-lg border focus:outline-none focus:ring-2">
                <button id="pasteButton" class="px-4 py-3 rounded-lg bg-gray-500 text-white font-semibold transition-all duration-200 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 transform hover:scale-103" title="הדבק אוטומטית">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                </button>
            </div>

            <div class="flex gap-2">
                <button id="searchButton" class="flex-1 px-4 py-3 rounded-lg bg-[#238636] text-white font-semibold transition-all duration-200 hover:bg-[#2ea043] focus:outline-none focus:ring-2 focus:ring-[#238636] transform hover:scale-103">חפש! 🔗</button>
                <button id="qaButton" class="px-4 py-3 rounded-lg bg-[#58a6ff] text-white font-semibold transition-all duration-200 hover:bg-[#68b7ff] focus:outline-none focus:ring-2 focus:ring-[#58a6ff] transform hover:scale-103">❓</button>
            </div>
        </div>

        <div id="messageContainer" class="mt-8 text-center text-lg hidden">
        </div>

        <p class="text-xs text-gray-500 text-center mt-8">האתר נוצר על ידי <a href="https://github.com/TheYali1" target="_blank" class="text-[#58a6ff] hover:underline">TheYali1</a></p>
    </div>

    <div id="qaModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeModal">&times;</span>
            <h2 class="text-2xl font-bold mb-4">Q&A</h2>
            <div class="mb-4">
                <h3 class="font-bold">איך אני מוצא סרטונים?</h3>
                <p class="text-sm text-gray-400">
                    המדריך המלא בסרטון הבא:<br>
                    <a href="https://youtu.be/auPsLB8LHrU?t=14" target="_blank" class="text-[#58a6ff] hover:underline">https://youtu.be/auPsLB8LHrU?t=14</a><br>
                </p>
            </div>
        </div>
    </div>

    <script>
        const searchButton = document.getElementById('searchButton');
        const videoUrlInput = document.getElementById('videoUrlInput');
        const messageContainer = document.getElementById('messageContainer');
        const qaButton = document.getElementById('qaButton');
        const qaModal = document.getElementById('qaModal');
        const closeModal = document.getElementById('closeModal');
        const pasteButton = document.getElementById('pasteButton');
        const body = document.body;
        const modeToggle = document.getElementById('modeToggle');
        const moonIcon = document.getElementById('moonIcon');
        const sunIcon = document.getElementById('sunIcon');

        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                body.classList.add('body-loaded');
            }, 50); 
        });

        function setMode(isLight) {
            if (isLight) {
                body.classList.add('light-mode');
                moonIcon.classList.add('hidden');
                sunIcon.classList.remove('hidden');
                localStorage.setItem('mode', 'light');
            } else {
                body.classList.remove('light-mode');
                moonIcon.classList.remove('hidden');
                sunIcon.classList.add('hidden');
                localStorage.setItem('mode', 'dark');
            }
        }

        const savedMode = localStorage.getItem('mode') || 'dark';
        setMode(savedMode === 'light');

        modeToggle.addEventListener('click', () => {
            const isLight = body.classList.contains('light-mode');
            setMode(!isLight);
        });

        pasteButton.addEventListener('click', async () => {
            if ('clipboard' in navigator) {
                try {
                    const text = await navigator.clipboard.readText();
                    videoUrlInput.value = text.trim();
                    videoUrlInput.focus();
                } catch (err) {
                    showMessage('אופס! לא הצלחתי לגשת ללוח. הדבק ידנית. 😔', 'text-red-500');
                    console.error('Failed to read clipboard contents: ', err);
                }
            } else {
                showMessage('הדפדפן שלך לא תומך בהדבקה אוטומטית. הדבק ידנית. 😓', 'text-red-500');
            }
        });
        
        searchButton.addEventListener('click', async () => {
            const videoUrl = videoUrlInput.value.trim();
            messageContainer.classList.add('hidden');
            messageContainer.innerHTML = '';

            const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=|shorts\/)|youtu\.be\/)([^"&?\/\s]{11})/;
            const match = videoUrl.match(regex);

            if (!match || !match[1]) {
                showMessage('קישור לא תקין! ❌', 'text-red-500');
                return;
            }

            showMessage('<div class="flex justify-center"><div class="loader"></div></div>', 'text-gray-400');
            
            const videoId = match[1];
            const fullYouTubeUrl = `https://www.youtube.com/watch?v=${videoId}`;
            
            let oldestWebpageUrl = null;
            
            try {
                const proxyUrl = `https://corsproxy.io/?` + encodeURIComponent(`https://web.archive.org/cdx/search/cdx?url=${videoUrl}&output=json`);
                const response = await fetch(proxyUrl);
                const data = await response.json();

                if (Array.isArray(data) && data.length > 1) {
                    let oldestTimestamp = Infinity;
                    for (const entry of data.slice(1)) {
                        const originalUrl = entry[2];
                        const timestamp = parseInt(entry[1]);
                        const mimetype = entry[3];
                        
                        if (mimetype.includes('text/html')) {
                            if (timestamp < oldestTimestamp) {
                                oldestTimestamp = timestamp;
                                oldestWebpageUrl = `https://web.archive.org/web/${oldestTimestamp}/${originalUrl}`;
                            }
                        }
                    }
                }
            } catch (err) {
                console.error('Error with original URL search:', err);
            }

            if (!oldestWebpageUrl) {
                try {
                    const proxyUrl = `https://corsproxy.io/?` + encodeURIComponent(`https://web.archive.org/cdx/search/cdx?url=${fullYouTubeUrl}&output=json`);
                    const response = await fetch(proxyUrl);
                    const data = await response.json();

                    if (Array.isArray(data) && data.length > 1) {
                        let oldestTimestamp = Infinity;
                        for (const entry of data.slice(1)) {
                            const originalUrl = entry[2];
                            const timestamp = parseInt(entry[1]);
                            const mimetype = entry[3];
                            
                            if (mimetype.includes('text/html')) {
                                if (timestamp < oldestTimestamp) {
                                    oldestTimestamp = timestamp;
                                    oldestWebpageUrl = `https://web.archive.org/web/${oldestTimestamp}/${originalUrl}`;
                                }
                            }
                        }
                    }
                } catch (err) {
                    console.error('Error with canonical URL search:', err);
                }
            }
            
            if (oldestWebpageUrl) {
                let message = `🎉 מצאתי את הסרטון ותוכל <a href="${oldestWebpageUrl}" target="_blank" class="text-[#58a6ff] hover:underline">לראות אותו פה</a>`;
                message += `<p class="text-xs mt-2 text-gray-500">שימו לב כנראה שהסרטון לא יעבוד בדף! ⚠️</p>`;
                showMessage(message, 'text-green-500');
            } else {
                showMessage('הסרטון לא נמצא, לצערנו! 😭', 'text-yellow-400');
                const recommendation = document.createElement('p');
                recommendation.className = 'text-xs mt-2 text-gray-500';
                recommendation.innerHTML = 'מומלץ בחום לבדוק בעצמך ב-Wayback Machine';
                messageContainer.appendChild(recommendation);
            }
        });

        function showMessage(text, color) {
            messageContainer.classList.remove('hidden', 'text-red-500', 'text-yellow-400', 'text-green-500', 'text-gray-400');
            messageContainer.innerHTML = text;
            messageContainer.classList.add(color);
        }

        qaButton.addEventListener('click', () => {
            qaModal.style.display = 'flex';
            setTimeout(() => {
                qaModal.classList.add('is-active');
            }, 10);
        });

        closeModal.addEventListener('click', () => {
            qaModal.classList.remove('is-active');
            setTimeout(() => {
                qaModal.style.display = 'none';
            }, 300);
        });

        window.addEventListener('click', (event) => {
            if (event.target == qaModal) {
                qaModal.classList.remove('is-active');
                setTimeout(() => {
                    qaModal.style.display = 'none';
                }, 300);
            }
        });
    </script>

</body>
</html>